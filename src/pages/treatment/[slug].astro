---
import { fetchGeneralData , fetchSubTreatmentData , fetchHomeData} from '../../utils/dataMapping.ts';
import MainLayout from "../../layouts/MainLayout.astro"
const GeneralData = await fetchGeneralData();

import DisorderGrid from "../../components/sections/DisorderGrid.astro";
import CTA from "../../components/CTA.astro";
import HeroProgram from "../../components/sections/HeroProgram.astro";
import TreatmentHero from '../../components/sections/TreatmentHero.astro';
import Treatment2 from '../../components/sections/Treatment2.astro';


export async function getStaticPaths() {
    const treatments = import.meta.glob('../../content/treatments/*.json', { eager: true });
    const paths = Object.keys(treatments).map((file) => {
        const slug = file.split('/').pop().replace('.json', '');
        return { params: { slug } };
    });
    return paths;
}

const sub_type = Astro.params.slug;

const { data: TreatmentData } = await fetchSubTreatmentData(sub_type);
const { data: HomeData } = await fetchHomeData();
---

<MainLayout title="Treatment" description="Mental Health Treatment at Clear Path">
    <HeroProgram Content={TreatmentData.hero} GeneralData={GeneralData} LinkData={HomeData.hero.heroLinks} />
    <TreatmentHero Content={TreatmentData.treatmentHero} />
    <Treatment2 Content={TreatmentData.treatment2} />
    <DisorderGrid Content={TreatmentData.disorders} />
	<CTA Content={TreatmentData.cta}/>
</MainLayout>